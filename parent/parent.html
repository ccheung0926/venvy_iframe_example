<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Parent</title>
  <style>
    iframe {
      border: 1px solid black;
      width: 200px;
      height: 200px;
    }
  </style>
</head>
<body>
  <h3>parent.html</h3>

  <iframe id="child_page" src="http://localhost:3000/child.html" frameborder="0"></iframe>

  <script>
    /*
    An arbitrary list of users that you want to check against from the child page.
    */
    var users_list = [
      {name: "Brendan Eich", fame: "Javascript"},
      {name: "David Heinemeir Hansson", fame: "Ruby on Rails"},
      {name: "Ryan Dahl", fame: "NodeJS"},
      {name: "TJ Holowaychuk", fame: "Express"},
      {name: "Isaac Scheulter", fame: "npm"},
      {name: "Douglas Crockford", fame: "JS the Good Parts"}
    ];

    var get_random_user = function (users) {
      return users[Math.floor(Math.random() * users.length)];
    }

    function parent_event_listener(e) {
      if (e.data.msg === "user_from_child") {
        /*
        Checking if a user from the child page is on this parent page.
        */
        var user;
        var random_user = get_random_user(users_list);
        if (random_user.name === e.data.user.name) {
          user = random_user;
        } else {
          user = undefined;
        }
        document.getElementById("child_page").contentWindow.postMessage({
          msg: "user_from_parent",
          user: user
        }, "*");
      } else if (e.data.msg === "get_port") {

      }
    }

    window.addEventListener("message", parent_event_listener);
  </script>
</body>
</html>
